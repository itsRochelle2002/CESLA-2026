<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Member Login - CLIMBS</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/global.css" />
    <style>
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "DM Sans", sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
      }

      /* ── HEADER ── */
      header {
        padding: 16px 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(201, 168, 76, 0.2);
        background: rgba(13, 27, 62, 0.6);
        backdrop-filter: blur(10px);
        animation: slideDown 0.6s ease both;
      }
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header-back {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 1.1rem;
        text-decoration: none;
        transition:
          background 0.2s,
          transform 0.2s;
        flex-shrink: 0;
      }
      .header-back:hover {
        background: rgba(201, 168, 76, 0.2);
        border-color: rgba(201, 168, 76, 0.5);
        transform: translateX(-3px);
      }

      .header-center {
        flex: 1;
        text-align: center;
      }
      .header-center h1 {
        font-family: "Playfair Display", serif;
        font-size: 1.35rem;
        font-weight: 800;
        color: #fff;
        letter-spacing: 0.5px;
      }
      .header-center h1 span {
        color: #c9a84c;
      }
      .header-center p {
        font-size: 0.68rem;
        color: rgba(232, 200, 122, 0.65);
        letter-spacing: 2.5px;
        text-transform: uppercase;
        margin-top: 3px;
        font-weight: 300;
      }

      .header-spacer {
        width: 40px;
        flex-shrink: 0;
      }

      /* ── MAIN ── */
      main {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
      }

      /* ── LOGIN CARD ── */
      .login-card {
        background: rgba(255, 255, 255, 0.07);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 24px;
        padding: 48px 44px 40px;
        width: 100%;
        max-width: 420px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        backdrop-filter: blur(14px);
        box-shadow:
          0 24px 64px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        animation: fadeUp 0.6s ease both;
        position: relative;
        overflow: hidden;
      }
      /* Gold top shimmer */
      .login-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 10%;
        right: 10%;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(201, 168, 76, 0.6),
          transparent
        );
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(28px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Icon */
      .icon-wrap {
        width: 82px;
        height: 82px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .icon-wrap svg {
        width: 46px;
        height: 46px;
      }
      .icon-ring {
        position: absolute;
        inset: -6px;
        border-radius: 50%;
        border: 1.5px dashed rgba(201, 168, 76, 0.3);
        animation: spinSlow 14s linear infinite;
      }
      @keyframes spinSlow {
        to {
          transform: rotate(360deg);
        }
      }

      .card-title {
        font-family: "Playfair Display", serif;
        font-size: 1.2rem;
        font-weight: 700;
        color: #fff;
        text-align: center;
        line-height: 1.3;
      }
      .card-sub {
        font-size: 0.74rem;
        color: rgba(255, 255, 255, 0.38);
        text-align: center;
        font-weight: 300;
        margin-top: -10px;
        letter-spacing: 0.3px;
      }

      /* Hint box */
      .uid-hint {
        width: 100%;
        background: rgba(201, 168, 76, 0.08);
        border: 1px solid rgba(201, 168, 76, 0.2);
        border-radius: 10px;
        padding: 10px 14px;
        font-size: 0.72rem;
        color: rgba(232, 200, 122, 0.8);
        font-weight: 400;
        line-height: 1.6;
      }
      .uid-hint strong {
        color: #e8c87a;
        font-weight: 700;
      }

      /* Field groups */
      .field-group {
        display: flex;
        flex-direction: column;
        gap: 7px;
        width: 100%;
      }
      .field-group label {
        font-size: 0.75rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.6);
        padding-left: 2px;
        letter-spacing: 0.5px;
      }
      .input-wrap {
        position: relative;
      }
      .input-wrap input {
        width: 100%;
        padding: 13px 46px 13px 16px;
        background: rgba(255, 255, 255, 0.08);
        border: 1.5px solid rgba(255, 255, 255, 0.1);
        border-radius: 11px;
        font-family: "DM Sans", sans-serif;
        font-size: 0.88rem;
        font-weight: 500;
        color: #fff;
        outline: none;
        transition:
          border-color 0.2s,
          background 0.2s;
      }
      .input-wrap input::placeholder {
        color: rgba(255, 255, 255, 0.25);
      }
      .input-wrap input:focus {
        border-color: rgba(201, 168, 76, 0.55);
        background: rgba(255, 255, 255, 0.11);
      }
      .input-wrap input.error {
        border-color: rgba(231, 76, 60, 0.7);
      }

      .eye-btn {
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.35);
        display: flex;
        transition: color 0.2s;
      }
      .eye-btn:hover {
        color: rgba(255, 255, 255, 0.7);
      }
      .eye-btn svg {
        width: 18px;
        height: 18px;
      }

      /* Messages */
      .error-msg {
        font-size: 0.73rem;
        color: rgba(231, 76, 60, 0.9);
        font-weight: 500;
        text-align: center;
        display: none;
        width: 100%;
        background: rgba(231, 76, 60, 0.1);
        border: 1px solid rgba(231, 76, 60, 0.2);
        border-radius: 8px;
        padding: 9px 12px;
      }
      .error-msg.show {
        display: block;
      }

      .pending-msg {
        font-size: 0.73rem;
        color: rgba(255, 193, 7, 0.9);
        font-weight: 500;
        text-align: center;
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.25);
        border-radius: 8px;
        padding: 10px 14px;
        display: none;
        width: 100%;
        line-height: 1.5;
      }
      .pending-msg.show {
        display: block;
      }

      /* Login button */
      .btn-login {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #c9a84c, #e8c87a);
        color: #0d1b3e;
        font-family: "DM Sans", sans-serif;
        font-size: 0.84rem;
        font-weight: 700;
        letter-spacing: 2px;
        text-transform: uppercase;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(201, 168, 76, 0.35);
        transition:
          transform 0.2s,
          box-shadow 0.2s,
          filter 0.2s;
        margin-top: 4px;
      }
      .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 28px rgba(201, 168, 76, 0.5);
        filter: brightness(1.07);
      }
      .btn-login:active {
        transform: translateY(0);
      }

      /* Register link */
      .register-link {
        font-size: 0.76rem;
        font-weight: 400;
        color: rgba(255, 255, 255, 0.4);
        text-decoration: none;
        transition: color 0.2s;
        text-align: center;
      }
      .register-link:hover {
        color: #c9a84c;
      }
      .register-link strong {
        color: rgba(201, 168, 76, 0.8);
        font-weight: 600;
      }

      /* Footer */
      footer {
        text-align: center;
        padding: 14px 40px 22px;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
      }
      footer p {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.2);
        font-weight: 300;
      }

      @media (max-width: 480px) {
        header {
          padding: 12px 20px;
        }
        .header-center h1 {
          font-size: 1.05rem;
        }
        .login-card {
          padding: 36px 24px 30px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <a href="#" class="header-back" id="backBtn">&#8592;</a>
      <div class="header-center">
        <h1>Member <span>Login</span></h1>
        <p>CESLA Multi-Purpose Cooperative</p>
      </div>
      <div class="header-spacer"></div>
    </header>

    <main>
      <div class="login-card">
        <div class="icon-wrap">
          <svg
            viewBox="0 0 46 46"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="23" cy="16" r="10" fill="rgba(201,168,76,0.85)" />
            <path
              d="M4 44c0-10.493 8.507-19 19-19s19 8.507 19 19"
              fill="rgba(201,168,76,0.55)"
            />
          </svg>
          <div class="icon-ring"></div>
        </div>

        <div class="card-title">Welcome Back!</div>
        <div class="card-sub">Login to access your membership account</div>

        <div class="uid-hint">
          &#128275; Use your <strong>User ID</strong> (e.g.
          <strong>CESLA-2025-00001</strong>) and <strong>Password</strong> to
          login.
        </div>

        <div class="field-group">
          <label>USER ID</label>
          <div class="input-wrap">
            <input
              type="text"
              id="userId"
              placeholder="e.g. CESLA-2025-00001"
              autocomplete="off"
              oninput="this.value = this.value.toUpperCase()"
              onkeydown="if (event.key === 'Enter') handleLogin();"
            />
          </div>
        </div>

        <div class="field-group">
          <label>PASSWORD</label>
          <div class="input-wrap">
            <input
              type="password"
              id="password"
              placeholder="Enter your password"
              onkeydown="if (event.key === 'Enter') handleLogin();"
            />
            <button class="eye-btn" type="button" onclick="togglePw()">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
            </button>
          </div>
        </div>

        <div class="error-msg" id="errorMsg"></div>
        <div class="pending-msg" id="pendingMsg">
          &#9203; Your account is still <strong>pending verification</strong>.
          Please wait for admin approval.
        </div>

        <button class="btn-login" onclick="handleLogin()">
          &#8594; &nbsp; Login
        </button>

        <a href="/membership/register" class="register-link">
          Don't have an account? &nbsp;<strong>Register as New Member</strong>
        </a>
      </div>
    </main>

    <footer>
      <p>
        CESLA Multi-Purpose Cooperative &nbsp;&bull;&nbsp; Membership Portal
        &nbsp;&bull;&nbsp; 2025
      </p>
    </footer>

    <script>
      // Dynamic back button based on source
      const _p = new URLSearchParams(window.location.search);
      document.getElementById("backBtn").href =
        _p.get("from") === "canteen" ? "/ordering" : "/membership";

      function togglePw() {
        const el = document.getElementById("password");
        el.type = el.type === "password" ? "text" : "password";
      }

      function handleLogin() {
        const userId = document.getElementById("userId").value.trim();
        const password = document.getElementById("password").value;
        const errorMsg = document.getElementById("errorMsg");
        const pendingMsg = document.getElementById("pendingMsg");

        errorMsg.classList.remove("show");
        pendingMsg.classList.remove("show");
        document.getElementById("userId").classList.remove("error");
        document.getElementById("password").classList.remove("error");

        if (!userId || !password) {
          document.getElementById("userId").classList.toggle("error", !userId);
          document
            .getElementById("password")
            .classList.toggle("error", !password);
          errorMsg.textContent = "❌ Please fill in all fields.";
          errorMsg.classList.add("show");
          return;
        }

        const params = new URLSearchParams(window.location.search);
        const from = params.get("from");
        const redirectTo =
          from === "canteen" ? "/canteen/order" : "/membership/dashboard";

        fetch("/membership/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId, password }),
        })
          .then((r) => r.json())
          .then((data) => {
            if (data.success) {
              window.location.href = redirectTo;
            } else if (data.pending) {
              pendingMsg.classList.add("show");
              document.getElementById("userId").classList.add("error");
              document.getElementById("password").classList.add("error");
            } else {
              errorMsg.textContent =
                data.message || "❌ Invalid User ID or password.";
              errorMsg.classList.add("show");
              document.getElementById("userId").classList.add("error");
              document.getElementById("password").classList.add("error");
            }
          })
          .catch(() => {
            errorMsg.textContent = "❌ Server error. Please try again.";
            errorMsg.classList.add("show");
          });
      }
    </script>
  </body>
</html>
